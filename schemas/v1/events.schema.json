{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://ciacob.github.io/OpenScoreIR/schemas/v1/events.schema.json",
    "$defs": {
        "Event": {
            "type": "object",
            "properties": {
                "kind": {
                    "enum": [
                        "regular",
                        "grace",
                        "percussion"
                    ],
                    "default": "regular"
                },
                "duration": {
                    "$ref": "./common.schema.json#/$defs/Fraction"
                },
                "pitches": {
                    "type": "array",
                    "items": {
                        "$ref": "./common.schema.json#/MidiValue"
                    }
                },
                "notes": {
                    "type": "array",
                    "items": {
                        "$ref": "./common.schema.json#/NoteInstance"
                    }
                },
                "noteSymbol": {
                    "$ref": "./common.schema.json#/NoteSymbol"
                },
                "attachments": {
                    "$ref": "./common.schema.json#/AttachableInstances"
                },
                "midiOuts": {
                    "$ref": "./common.schema.json#/AttachableInstances"
                },
                "useSlash": {
                    "type": "boolean",
                    "default": true
                },
                "useSlur": {
                    "type": "boolean",
                    "default": true
                },
                "stealNext": {
                    "type": "boolean",
                    "default": false
                },
                "setId": {
                    "$ref": "./common.schema.json#/$defs/Uuid"
                },
                "strikes": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "minItems": 1
                }
            },
            "required": [
                "duration"
            ],
            "allOf": {
                "if": {
                    "properties": {
                        "kind": {
                            "const": "percussion"
                        }
                    }
                },
                "then": {
                    "required": [
                        "setId",
                        "strikes"
                    ]
                }
            }
        },
        "EventGroup": {
            "type": "object",
            "properties": {
                "kind": {
                    "type": "string",
                    "enum": [
                        "tuplet",
                        "beam"
                    ]
                },
                "groupEvents": {
                    "oneOf": [
                        {
                            "$ref": "#/$defs/Event"
                        },
                        {
                            "ref": "#/$defs/EventGroup"
                        }
                    ]
                },
                "numTupletBeats": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 128
                },
                "numRegularBeats": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 128
                },
                "tupletBeatDuration": {
                    "$ref": "./common.schema.json#/$defs/Fraction"
                },
                "regularBeatDuration": {
                    "$ref": "./common.schema.json#/$defs/Fraction"
                }
            },
            "required": [
                "groupEvents"
            ],
            "allOf": {
                "if": {
                    "properties": {
                        "kind": {
                            "const": "tuplet"
                        }
                    }
                },
                "then": {
                    "required": [
                        "numTupletBeats",
                        "numRegularBeats",
                        "tupletBeatDuration",
                        "regularBeatDuration"
                    ]
                }
            },
            "unevaluatedProperties": false
        },
        "MusicSpan": {
            "type": "object",
            "properties": {
                "kind": {
                    "enum": [
                        "regular",
                        "multiRest"
                    ],
                    "default": "regular"
                },
                "part": {
                    "$ref": "./common.schema.json#/$defs/Uuid"
                },
                "measure": {
                    "$ref": "./common.schema.json#/$defs/Uuid"
                },
                "events": {
                    "type": "array",
                    "items": {
                        "oneOf": [
                            {
                                "$ref": "#/$defs/Event"
                            },
                            {
                                "$ref": "#/$defs/EventGroup"
                            }
                        ]
                    }
                },
                "fromMeasure": {
                    "$ref": "./common.schema.json#/$defs/Uuid"
                },
                "toMeasure": {
                    "$ref": "./common.schema.json#/$defs/Uuid"
                }
            },
            "required": [
                "part",
                "measure",
                "events"
            ],
            "allOf": [
                {
                    "if": {
                        "properties": {
                            "kind": {
                                "const": "multiRest"
                            }
                        }
                    },
                    "then": {
                        "required": [
                            "fromMeasure",
                            "toMeasure"
                        ],
                        "not": {
                            "required": [
                                "measure",
                                "events"
                            ]
                        }
                    }
                }
            ],
            "unevaluatedProperties": false
        }
    },
    "MusicSpans": {
        "type": "object",
        "patternProperties": {
            "^[a-f0-9-]{36}$": {
                "$ref": "#/$defs/MusicSpan"
            }
        }
    }
}