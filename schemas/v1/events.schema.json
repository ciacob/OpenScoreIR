{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://ciacob.github.io/OpenScoreIR/schemas/v1/events.schema.json",
    "definitions": {
        "RegularEvent": {
            "type": "object",
            "required": [
                "duration"
            ],
            "properties": {
                "kind": {
                    "const": "regular"
                },
                "duration": {
                    "$ref": "./common.schema.json#/definitions/Fraction"
                },
                "pitches": {
                    "type": "array",
                    "items": {
                        "$ref": "./common.schema.json#/definitions/MidiValue"
                    },
                    "minItems": 1
                },
                "notes": {
                    "type": "array",
                    "items": {
                        "$ref": "./common.schema.json#/definitions/NoteInstance"
                    },
                    "minItems": 1
                },
                "noteSymbol": {
                    "$ref": "./common.schema.json#/definitions/NoteSymbol"
                },
                "attachments": {
                    "$ref": "./attachables.schema.json#/definitions/AttachableInstances"
                },
                "midiOuts": {
                    "$ref": "./attachables.schema.json#/definitions/AttachableInstances"
                }
            },
            "additionalProperties": false
        },
        "GraceEvent": {
            "type": "object",
            "required": [
                "kind",
                "duration",
                "pitches"
            ],
            "properties": {
                "kind": {
                    "const": "grace"
                },
                "duration": {
                    "$ref": "./common.schema.json#/definitions/Fraction"
                },
                "pitches": {
                    "type": "array",
                    "items": {
                        "$ref": "./common.schema.json#/definitions/MidiValue"
                    },
                    "minItems": 1
                },
                "notes": {
                    "type": "array",
                    "items": {
                        "$ref": "./common.schema.json#/definitions/NoteInstance"
                    },
                    "minItems": 1
                },
                "noteSymbol": {
                    "$ref": "./common.schema.json#/definitions/NoteSymbol"
                },
                "attachments": {
                    "$ref": "./attachables.schema.json#/definitions/AttachableInstances"
                },
                "midiOuts": {
                    "$ref": "./attachables.schema.json#/definitions/AttachableInstances"
                },
                "useSlash": {
                    "$comment": "Only applies when `kind` is `grace`.",
                    "type": "boolean",
                    "default": true
                },
                "useSlur": {
                    "$comment": "Only applies when `kind` is `grace`.",
                    "type": "boolean",
                    "default": true
                },
                "stealNext": {
                    "$comment": "Only applies when `kind` is `grace`.",
                    "type": "boolean",
                    "default": false
                }
            },
            "additionalProperties": false
        },
        "PercussionEvent": {
            "type": "object",
            "required": [
                "kind",
                "duration",
                "setId",
                "strikes"
            ],
            "properties": {
                "kind": {
                    "const": "percussion"
                },
                "duration": {
                    "$ref": "./common.schema.json#/definitions/Fraction"
                },
                "noteSymbol": {
                    "$ref": "./common.schema.json#/definitions/NoteSymbol"
                },
                "attachments": {
                    "$ref": "./attachables.schema.json#/definitions/AttachableInstances"
                },
                "midiOuts": {
                    "$ref": "./attachables.schema.json#/definitions/AttachableInstances"
                },
                "setId": {
                    "$comment": "Only applies when `kind` is `percussion`.",
                    "$ref": "./common.schema.json#/definitions/Uuid"
                },
                "strikes": {
                    "$comment": "Only applies when `kind` is `percussion`.",
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "minItems": 1
                }
            },
            "additionalProperties": false
        },
        "Event": {
            "oneOf": [
                {
                    "$ref": "#/definitions/RegularEvent"
                },
                {
                    "$ref": "#/definitions/GraceEvent"
                },
                {
                    "$ref": "#/definitions/PercussionEvent"
                }
            ]
        },
        "TupletGroup": {
            "type": "object",
            "required": [
                "kind",
                "numTupletBeats",
                "numRegularBeats",
                "tupletBeatDuration",
                "regularBeatDuration",
                "groupEvents"
            ],
            "properties": {
                "kind": {
                    "const": "tuplet"
                },
                "numTupletBeats": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 128
                },
                "numRegularBeats": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 128
                },
                "tupletBeatDuration": {
                    "$ref": "./common.schema.json#/definitions/Fraction"
                },
                "regularBeatDuration": {
                    "$ref": "./common.schema.json#/definitions/Fraction"
                },
                "groupEvents": {
                    "type": "array",
                    "items": {
                        "oneOf": [
                            {
                                "$ref": "#/definitions/Event"
                            },
                            {
                                "$ref": "#/definitions/EventGroup"
                            }
                        ]
                    },
                    "minItems": 1
                }
            },
            "additionalProperties": false
        },
        "BeamGroup": {
            "type": "object",
            "properties": {
                "kind": {
                    "const": "beam"
                },
                "groupEvents": {
                    "type": "array",
                    "items": {
                        "oneOf": [
                            {
                                "$ref": "#/definitions/Event"
                            },
                            {
                                "$ref": "#/definitions/EventGroup"
                            }
                        ]
                    },
                    "minItems": 1
                }
            },
            "required": ["kind", "groupEvents"],
            "additionalProperties": false
        },
        "EventGroup": {
            "oneOf": [
                {
                    "$ref": "#/definitions/TupletGroup"
                },
                {
                    "$ref": "#/definitions/BeamGroup"
                }
            ]
        },
        "RegularSpan": {
            "type": "object",
            "required": [
                "part",
                "measure"
            ],
            "properties": {
                "kind": {
                    "const": "regular"
                },
                "part": {
                    "$ref": "./common.schema.json#/definitions/Uuid"
                },
                "measure": {
                    "$ref": "./common.schema.json#/definitions/Uuid"
                },
                "events": {
                    "type": "array",
                    "items": {
                        "oneOf": [
                            {
                                "$ref": "#/definitions/Event"
                            },
                            {
                                "$ref": "#/definitions/EventGroup"
                            }
                        ]
                    }
                }
            },
            "additionalProperties": false
        },
        "MultiRestSpan": {
            "type": "object",
            "required": [
                "kind",
                "fromMeasure",
                "toMeasure"
            ],
            "properties": {
                "kind": {
                    "const": "multiRest"
                },
                "part": {
                    "$ref": "./common.schema.json#/definitions/Uuid"
                },
                "fromMeasure": {
                    "$ref": "./common.schema.json#/definitions/Uuid"
                },
                "toMeasure": {
                    "$ref": "./common.schema.json#/definitions/Uuid"
                }
            },
            "additionalProperties": false
        },
        "MusicSpan": {
            "oneOf": [
                {
                    "$ref": "#/definitions/RegularSpan"
                },
                {
                    "$ref": "#/definitions/MultiRestSpan"
                }
            ]
        },
        "MusicSpans": {
            "type": "object",
            "propertyNames": {
                "$ref": "./common.schema.json#/definitions/Uuid"
            },
            "additionalProperties": {
                "$ref": "#/definitions/MusicSpan"
            }
        }
    }
}